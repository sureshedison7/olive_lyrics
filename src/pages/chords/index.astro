---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import ArrowCardSSR from "@components/ArrowCardSSR.astro";
import { SITE } from "@consts";

export const prerender = false; // Important if you need dynamic data

import type { D1Database } from "@cloudflare/workers-types";

interface Env {
  DB: D1Database;
}

let lyrics: any[] = [];
try {
  const DB = Astro.locals.runtime.env.DB as D1Database;
  const { results } = await DB.prepare("SELECT * FROM songs").all();
  lyrics = results;
} catch (error) {
  console.error("Error fetching lyrics:", error);
}
---

<Layout
  title="Christian Lyrics"
  description="Collection of Christian worship lyrics"
>
  <Container>
    <div class="space-y-6">
      <div class="animate font-semibold text-black dark:text-white">
        Christian Lyrics
      </div>
      {
        lyrics.length > 0 ? (
          <ul class="not-prose flex flex-col gap-4">
            {lyrics.map((lyric) => (
              <li>
                {lyric.LyricPage}
                <ArrowCardSSR
                  lyricsTitle={lyric ? lyric.title : "Lyrics Not Found"}
                  discription={
                    lyric ? lyric.description : "No Lyrics found with this name"
                  }
                  lyricsLink={lyric ? "chords/"+lyric.url : "#"}
                />
              </li>
            ))}
          </ul>
        ) : (
          <p>No Lyrics found.</p>
        )
      }
    </div>
  </Container>
</Layout>
