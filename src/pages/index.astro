---
// Astro Imports
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import ArrowCardSSR from "@components/ArrowCardSSR.astro";
import Link from "@components/Link.astro";
import { SITE, HOME, SOCIALS } from "@consts";
import type { D1Database } from "@cloudflare/workers-types";

// D1 Lyrics Fetch
export const prerender = false;
interface Env {
  DB: D1Database;
}

let lyrics: any[] = [];
try {
  const DB = Astro.locals.runtime.env.DB as D1Database;
  const { results } = await DB.prepare(
    "SELECT * FROM songs ORDER BY pub_date DESC",
  ).all();
  lyrics = results;
} catch (error) {
  console.error("Error fetching lyrics:", error);
}
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <!-- HERO SECTION -->
    <section class="animate mb-16 text-center">
      <h1 class="mb-4 text-5xl font-extrabold text-black dark:text-white">
        Olive <span class="text-primary-600">Lyrics</span>
      </h1>
      <p class="mx-auto max-w-xl text-lg text-gray-600 dark:text-gray-300">
        Discover lyrics and chords for your favorite songs ‚Äî perfect for
        musicians, worship leaders, and music lovers.
      </p>

      <!-- Search -->
      <div class="mx-auto mt-8 max-w-2xl">
        <form action="/search" method="GET" class="relative">
          <input
            type="text"
            name="q"
            placeholder="Search for songs, artists or lyrics..."
            class="focus:ring-primary-500 w-full rounded-full border border-gray-300 px-6 py-3 shadow-sm dark:border-gray-600 dark:bg-gray-800 dark:text-white"
          />
          <button
            type="submit"
            class="bg-primary-600 hover:bg-primary-700 absolute top-1/2 right-2 -translate-y-1/2 rounded-full p-2 text-white"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
          </button>
        </form>
      </div>
    </section>

    <!-- FEATURED SONG -->
    {
      lyrics[0] && (
        <section class="animate bg-primary-50 dark:bg-primary-950 mb-12 rounded-xl p-6">
          <h2 class="text-primary-700 dark:text-primary-200 text-lg font-bold">
            üé§ Featured Lyric
          </h2>
          <ArrowCardSSR
            lyricsTitle={lyrics[0].title}
            discription={lyrics[0].description}
            lyricsLink={`lyrics/${lyrics[0].url}`}
          />
        </section>
      )
    }

    <!-- LATEST LYRICS -->
    <section class="animate mb-12 space-y-6">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          üé∂ Latest Lyrics
        </h2>
        <Link href="/lyrics">See all lyrics ‚Üí</Link>
      </div>
      <ul class="flex flex-col gap-4">
        {
          lyrics.slice(0, 5).map((lyric) => (
            <li>
              <ArrowCardSSR
                lyricsTitle={lyric.title}
                discription={lyric.description}
                lyricsLink={`lyrics/${lyric.url}`}
              />
            </li>
          ))
        }
      </ul>
    </section>

    <!-- LATEST CHORDS -->
    <section class="animate mb-12 space-y-6">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold text-black dark:text-white">
          üé∏ Latest Chords
        </h2>
        <Link href="/chords">See all chords ‚Üí</Link>
      </div>
      <ul class="flex flex-col gap-4">
        {
          lyrics.slice(0, 5).map((lyric) => (
            <li>
              <ArrowCardSSR
                lyricsTitle={lyric.title}
                discription={lyric.description}
                lyricsLink={`chords/${lyric.url}`}
              />
            </li>
          ))
        }
      </ul>
    </section>

    <!-- CATEGORIES (static sample) -->
    <section class="animate mb-12">
      <h2 class="mb-4 text-xl font-semibold text-black dark:text-white">
        üéº Browse by Category
      </h2>
      <ul class="flex flex-wrap gap-3">
        {
          ["Worship", "Praise", "Christmas", "Gospel", "Tamil", "English"].map(
            (cat) => (
              <li>
                <Link
                  href={`/category/${cat.toLowerCase()}`}
                  class="bg-primary-100 text-primary-700 dark:bg-primary-900 dark:text-primary-200 inline-block rounded-full px-4 py-1 text-sm font-medium"
                >
                  {cat}
                </Link>
              </li>
            ),
          )
        }
      </ul>
    </section>

    <!-- CONNECT SECTION -->
    <section class="animate mb-16 space-y-4">
      <h2 class="text-xl font-semibold text-black dark:text-white">
        ü§ù Let's Connect
      </h2>
      <p>
        If you'd like to say hi or ask something, feel free to reach out through
        social media or email.
      </p>
      <ul class="flex flex-wrap gap-3">
        {
          SOCIALS.map((s) => (
            <li>
              <Link
                href={s.HREF}
                external
                aria-label={`${SITE.TITLE} on ${s.NAME}`}
              >
                {s.NAME}
              </Link>
            </li>
          ))
        }
        <li>
          <Link href={`mailto:${SITE.EMAIL}`} aria-label="Email us"
            >{SITE.EMAIL}</Link
          >
        </li>
      </ul>
    </section>

    <!-- NEWSLETTER (optional) -->
    <section class="animate mb-16 rounded-lg bg-gray-50 p-6 dark:bg-gray-900">
      <h2 class="mb-2 text-xl font-semibold text-black dark:text-white">
        üì¨ Subscribe to Our Newsletter
      </h2>
      <p class="mb-4 text-sm text-gray-600 dark:text-gray-400">
        Get fresh lyrics and chord updates delivered to your inbox.
      </p>
      <form
        method="POST"
        action="/subscribe"
        class="flex max-w-lg flex-wrap gap-2"
      >
        <input
          type="email"
          name="email"
          placeholder="Your email"
          required
          class="flex-1 rounded-md border px-4 py-2 dark:border-gray-600 dark:bg-black"
        />
        <button
          type="submit"
          class="bg-primary-600 hover:bg-primary-700 rounded-md px-4 py-2 text-white"
          >Subscribe</button
        >
      </form>
    </section>
  </Container>
</Layout>
